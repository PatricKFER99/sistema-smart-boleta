<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // --- CONEXIÃ“N A SUPABASE (CON NOMBRE ÃšNICO PARA EVITAR ERRORES) ---
        const SUPABASE_URL = 'https://ezgswcgsgxwskofhcorc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV6Z3N3Y2dzZ3h3c2tvZmhjb3JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NzMwMTEsImV4cCI6MjA3OTM0OTAxMX0.qQM7va7uKQkMaGw0LLnYujNh3U2YsxF0THlRhv1_sXk';
        
        // AquÃ­ cambiamos "const supabase" por "const clienteLogin"
        const clienteLogin = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function login(e) {
            e.preventDefault();
            const dni = document.getElementById('dni').value.trim();
            const password = document.getElementById('password').value.trim();
            const btn = document.getElementById('btnIngresar');
            
            btn.disabled = true;
            btn.textContent = "Verificando...";

            try {
                // Usamos clienteLogin en lugar de supabase
                let { data: trabajador } = await clienteLogin.from('trabajadores').select('*').eq('dni', dni).eq('password', password).single();
                
                if (trabajador) {
                    accesoExitoso(trabajador, false);
                    return;
                }

                // Usamos clienteLogin aquÃ­ tambiÃ©n
                let { data: admin } = await clienteLogin.from('administradores').select('*').eq('dni', dni).eq('password', password).single();

                if (admin) {
                    accesoExitoso(admin, true);
                    return;
                }

                Swal.fire('Error', 'Usuario o contraseÃ±a incorrectos', 'error');
                btn.disabled = false;
                btn.textContent = "INGRESAR";

            } catch (error) {
                console.error(error);
                Swal.fire('Error', 'Error de conexiÃ³n o datos', 'error');
                btn.disabled = false;
                btn.textContent = "INGRESAR";
            }
        }

        function accesoExitoso(usuario, esAdminTabla) {
            if(esAdminTabla) usuario.es_admin = true; 
            localStorage.setItem('usuarioLogueado', JSON.stringify(usuario));
            
            const destino = (usuario.es_admin) ? 'admin-panel.html' : 'dashboard.html';

            try {
                window.location.href = destino;
            } catch (err) {
                mostrarBotonManual(destino);
            }
        }

        function mostrarBotonManual(urlDestino) {
            const card = document.getElementById('loginCard');
            card.innerHTML = `
                <div style="padding: 3rem; text-align: center;">
                    <h2 style="color: #27ae60; margin-bottom: 1rem;">âœ… Â¡Bienvenido!</h2>
                    <p style="color: #7f8c8d;">Tus credenciales son correctas.</p>
                    <a href="${urlDestino}" class="manual-link">CONTINUAR AL SISTEMA ðŸ‘‰</a>
                </div>
            `;
        }
    </script>